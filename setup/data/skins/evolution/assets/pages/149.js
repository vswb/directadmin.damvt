(window.webpackJsonp=window.webpackJsonp||[]).push([[149],{1426:function(t,e,n){"use strict";n.r(e);var o=n(3162),r=n(2252);for(var s in r)"default"!==s&&function(t){n.d(e,t,(function(){return r[t]}))}(s);var a=n(0),i=n(2975),l=n.n(i),u=Object(a.a)(r.default,o.a,o.b,!1,null,null,null);"function"==typeof l.a&&l()(u),e.default=u.exports},1529:function(t,e,n){"use strict";n.r(e);var o,r=n(30),s=n.n(r),a=n(6),i=n(35),l=n(18),u=function(){return(u=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};!function(t){t.VALUE="value",t.CHECKBOX="checkbox"}(o||(o={}));var p=a.pipe(a.prop("keysize"),i.toSelectData),c=function(t,e){return u(u({id:t},e),{timestamp:Object(i.toAppDate)(e.timestamp)})},f={getKeys:{users:function(t){return l.Maybe.Some(t).flatMap((function(t){return l.Maybe.fromNull(t.users)})).orSome([])},options:a.prop("key_options"),sizes:p,public:function(t){return a.toPairs(t.public_keys).map(a.apply(c))},authorized:function(t){return a.values(t.authorized_keys).map(function(t){return function(e){var n=l.Maybe.Some(e).flatMap((function(t){return l.Maybe.fromNull(t.options)})).map(a.defaultTo({})).map(a.values).map(a.reduce((function(t,e){var n,o=e.name,r=e.value;return u(u({},t),((n={})[o]=r,n))}),{})).orSome({}),o=l.Maybe.Some(t).flatMap((function(t){return l.Maybe.fromNull(t.global_keys)})).flatMap((function(t){return l.Maybe.fromNull(t[e.fingerprint])})),r=o.map((function(t){return t.who})).orSome("no"),s=o.flatMap((function(t){return l.Maybe.fromNull(t.users)})).map(a.toPairs).map(a.filter(a.pipe(a.nth(1),a.prop("enabled"),a.equals("yes")))).map(a.map(a.head)).orSome([]);return u(u({},e),{options:n,global:r,users:"except"===r?a.without(s,t.users||[]):s})}}(t))}}};n.d(e,"getKeys",(function(){return v})),n.d(e,"createKey",(function(){return y})),n.d(e,"authorizeKeys",(function(){return h})),n.d(e,"deleteKeys",(function(){return b})),n.d(e,"deleteAuthorizedKeys",(function(){return _})),n.d(e,"pasteKey",(function(){return g})),n.d(e,"modifyKey",(function(){return O}));var m=function(){return(m=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},d="/CMD_SSH_KEYS",v=s.a.get({id:"SSH_KEYS",url:d,mapResponse:f.getKeys,schema:{enabled_users:s.a.OPTIONAL_BOOL,fingerprint:s.a.OPTIONAL_STRING}}),y=s.a.post({url:d,params:{action:"create",type:"rsa"},schema:{id:s.a.REQUIRED_STRING,comment:s.a.REQUIRED_STRING,keysize:s.a.REQUIRED_STRING,passwd:s.a.OPTIONAL_STRING,overwrite:s.a.REQUIRED_BOOL,authorize:s.a.REQUIRED_BOOL},before:function(t){return{passwd2:t.passwd}}}),h=s.a.select({url:d,params:{type:"public",authorize:!0}}),b=s.a.select({url:d,params:{type:"public",delete:!0}}),_=s.a.select({url:d,params:{type:"authorized_keys",delete:!0}}),g=s.a.post({url:d,params:{type:"paste",action:"authorize"},schema:{text:s.a.REQUIRED_STRING}}),O=s.a.post({url:"/CMD_SSH_KEYS",params:{action:"modify"},schema:{fingerprint:s.a.REQUIRED_STRING,comment:s.a.REQUIRED_STRING,options:{type:Object,required:!0,default:function(){return{}}},global:s.a.REQUIRED_BOOL,users:{type:Array,required:!0,default:function(){return[]}},who:s.a.OPTIONAL_STRING},before:function(t){var e=t.options,n=t.users,o=t.global;return m(m({},e),{global_key:o,select:n,options:null,global:null,users:null})}})},2252:function(t,e,n){"use strict";n.r(e);var o=n(2253),r=n.n(o);for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);e.default=r.a},2253:function(t,e,n){"use strict";var o=n(10),r=n(1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n(17)),a=r(n(2)),i=o(n(6)),l=n(1529),u=n(28),p={preload:function(t){var e=t.fingerprint;return(0,l.getKeys)({fingerprint:e,enabled_users:!0})},api:[{command:l.getKeys,bind:"keys"}],data:function(){return{comment:"",options:[],global:!1,who:"all",users:[]}},props:{fingerprint:{type:String,required:!0,default:""}},computed:{showGlobal:function(){return"user"!==this.$state.app.user.level},key:function(){var t=this;return this.$api.keys.authorized.find((function(e){return e.fingerprint===t.fingerprint}))},isOptionDefined:function(){var t=this;return function(e){return!!t.options.find((function(t){return t.name===e.value}))}},possibleOptions:function(){return i.pipe(i.toPairs,i.map(i.zipObj(["value","type"])),i.filter(i.complement(this.isOptionDefined)))(this.$api.keys.options)},mergedOptions:function(){return(0,u.mergeTransduce)([(0,u.filterReducer)((function(t){return!1!==t.value})),(0,u.mapReducer)((function(t){return(0,a.default)({},t.name,t.value)}))],this.options)},requestData:function(){return{comment:this.comment,fingerprint:this.fingerprint,options:this.mergedOptions,global:this.global,users:this.users,who:this.who}}},methods:{addOption:function(t){this.options.push({type:t.type,name:t.value,value:"value"===t.type&&""})},getOptionType:function(t){return(this.possibleOptions.find((function(e){return e.value===t}))||{}).type||"value"},modifyKey:function(){(0,l.modifyKey)(this.requestData).then(this.removeEmptyOptions)},removeEmptyOptions:function(){this.options=this.options.filter((function(t){return t.value}))}},created:function(){var t=this;this.comment=this.key.comment,this.options=Object.entries(this.key.options).map((function(e){var n=(0,s.default)(e,2),o=n[0];return{name:o,value:n[1],type:t.getOptionType(o)}})),this.global="no"!==this.key.global,this.global&&(this.who=this.key.global),this.users=this.key.users}};e.default=p},2975:function(t,e){},3162:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("app-page",[n("app-page-section",[n("translate",{attrs:{slot:"section:title"},slot:"section:title"},[t._v("Key Data")]),t._v(" "),n("ui-form-element",{attrs:{group:"editKey",validators:{required:!0}}},[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("Comment")]),t._v(" "),n("input-text",{attrs:{slot:"content"},slot:"content",model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1),t._v(" "),n("ui-form-element",[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("Fingerprint")]),t._v(" "),n("input-text",{attrs:{slot:"content",disabled:"",value:t.fingerprint},slot:"content"})],1),t._v(" "),n("ui-form-element",[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("Type")]),t._v(" "),n("input-text",{attrs:{slot:"content",disabled:"",value:t.key.type},slot:"content"})],1),t._v(" "),n("ui-form-element",{attrs:{underline:!1}},[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("Size")]),t._v(" "),n("input-text",{attrs:{slot:"content",disabled:"",value:t.key.keysize},slot:"content"})],1)],1),t._v(" "),n("app-page-section",[n("translate",{attrs:{slot:"section:title"},slot:"section:title"},[t._v("Key Options")]),t._v(" "),t._l(t.options,(function(e){return n("ui-form-element",{key:e.name},[n("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._v(" "),"value"===e.type?n("input-text",{attrs:{slot:"content"},slot:"content",model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"option.value"}}):"checkbox"===e.type?n("input-checkbox",{attrs:{slot:"content"},slot:"content",model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"option.value"}}):t._e()],1)})),t._v(" "),t.possibleOptions.length?n("ui-form-element",[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n                Add Option\n            ")]),t._v(" "),n("input-select-legacy",{attrs:{slot:"content",options:t.possibleOptions},on:{change:function(e){return t.addOption(e)}},slot:"content"})],1):t._e(),t._v(" "),t.showGlobal?n("ui-form-element",{attrs:{underline:!1}},[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("Global Key")]),t._v(" "),n("input-checkbox",{attrs:{slot:"content"},slot:"content",model:{value:t.global,callback:function(e){t.global=e},expression:"global"}})],1):t._e()],2),t._v(" "),t.showGlobal&&t.global?n("app-page-section",[n("translate",{attrs:{slot:"section:title"},slot:"section:title"},[t._v("Global Key Options")]),t._v(" "),n("ui-form-element",{attrs:{underline:!1}},[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("Apply To")]),t._v(" "),n("ui-grid",{attrs:{slot:"content"},slot:"content"},[n("input-check",{attrs:{type:"radio",value:"all"},model:{value:t.who,callback:function(e){t.who=e},expression:"who"}},[n("translate",[t._v("All Users")])],1),t._v(" "),n("input-check",{attrs:{type:"radio",value:"except"},model:{value:t.who,callback:function(e){t.who=e},expression:"who"}},[n("translate",[t._v("All Users Except Selected Users")])],1),t._v(" "),n("input-check",{attrs:{type:"radio",value:"selected"},model:{value:t.who,callback:function(e){t.who=e},expression:"who"}},[n("translate",[t._v("Selected Users")])],1)],1)],1),t._v(" "),n("transition",{attrs:{name:"fade"}},["all"!==t.who?n("ui-form-element",{attrs:{underline:!1}},[n("span",{attrs:{slot:"title"},slot:"title"},[t._v("Users")]),t._v(" "),n("input-select-multiple",{attrs:{slot:"content",options:t.$api.keys.users},slot:"content",model:{value:t.users,callback:function(e){t.users=e},expression:"users"}})],1):t._e()],1)],1):t._e(),t._v(" "),n("ui-button",{attrs:{slot:"footer:buttons",theme:"safe",size:"big",validateGroup:"editKey"},on:{click:t.modifyKey},slot:"footer:buttons"},[n("translate",[t._v("Save")])],1)],1)},r=[];n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return r}))}}]);