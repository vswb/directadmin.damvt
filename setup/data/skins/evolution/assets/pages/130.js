(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{1389:function(t,e,s){"use strict";s.r(e);var r=s(3125),i=s(2074);for(var a in i)"default"!==a&&function(t){s.d(e,t,(function(){return i[t]}))}(a);var n=s(0),o=s(2849),l=s.n(o),c=Object(n.a)(i.default,r.a,r.b,!1,null,null,null);"function"==typeof l.a&&l()(c),e.default=c.exports},1560:function(t,e,s){"use strict";var r=s(1);Object.defineProperty(e,"__esModule",{value:!0}),e.updateListInfo=e.getListInfo=e.deleteFromList=e.addToList=e.getDigestListSubscribers=e.getListSubscribers=e.deleteLists=e.purgeListArchives=e.createList=e.getLists=void 0;var i=r(s(23)),a=r(s(2)),n=r(s(30));function o(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,r)}return s}var l=n.default.get({id:"MAILING_LISTS",url:"/CMD_EMAIL_LIST",response:[],domain:!0,after:function(t){return t.flow(t.mapValues((function(t,e){return function(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?o(Object(s),!0).forEach((function(e){(0,a.default)(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):o(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}({list:e},t)})),t.toArray,t.mapArrayProps({archive_size:t.convert.toAppNumber,digest_subscribers:t.convert.toAppNumber,subscribers:t.convert.toAppNumber}))}});e.getLists=l;var c=n.default.post({url:"/CMD_EMAIL_LIST",params:{action:"create"},domain:!0,schema:{name:n.default.REQUIRED_STRING}});e.createList=c;var u=n.default.select({url:"/CMD_EMAIL_LIST",params:{purge_archives:!0,action:"delete"},domain:!0,schema:{purge_days:n.default.REQUIRED_STRING}});e.purgeListArchives=u;var d=n.default.select({url:"/CMD_EMAIL_LIST",params:{delete:!0,action:"delete"},domain:!0});e.deleteLists=d;var f=n.default.get({id:"LIST_SUBSCRIBERS",url:"/CMD_EMAIL_LIST",params:{action:"view"},domain:!0,pagination:!0,schema:{name:n.default.REQUIRED_STRING},after:function(t){return t.flow(t.deleteProp("digest_subscribers"),t.processTableInfo("subscribers"),t.moveProp("subscribers","rows"),t.mapProp("rows",t.toArray))}});e.getListSubscribers=f;var p=f.extend({id:"DIGEST_LIST_SUBSCRIBERS",after:function(t){return t.flow(t.deleteProp("subscribers"),t.processTableInfo("digest_subscribers"),t.moveProp("digest_subscribers","rows"),t.mapProp("rows",t.toArray))}});e.getDigestListSubscribers=p;var m=n.default.post({url:"/CMD_EMAIL_LIST",params:{action:"add"},domain:!0,schema:{name:n.default.REQUIRED_STRING,email:n.default.REQUIRED_STRING,type:n.default.REQUIRED_STRING}});e.addToList=m;var _=n.default.select({url:"/CMD_EMAIL_LIST",params:{action:"delete_subscriber",delete:!0},domain:!0,schema:{name:n.default.REQUIRED_STRING,digest:{type:Boolean,default:!1,required:!1}},before:function(t){return{action:t.digest?"delete_subscriber_digest":"delete_subscriber"}}});e.deleteFromList=_;var b=n.default.get({id:"LIST_INFO",url:"/CMD_EMAIL_LIST",params:{action:"modify"},domain:!0,schema:{name:n.default.REQUIRED_STRING},after:function(t){return t.flow(t.mapValues((function(e){return["yes","no"].includes(e)?t.convert.toAppBoolean(e):"object"===(0,i.default)(e)?(s=e,(r=Object.values(s).find((function(t){return t.selected})))?r.value:""):e;var s,r})),t.mapProps({message_fronter:t.convert.toAppText,info:t.convert.toAppText,taboo_body:t.convert.toAppText,taboo_headers:t.convert.toAppText,message_footer:t.convert.toAppText,message_headers:t.convert.toAppText}))}});e.getListInfo=b;var v=n.default.post({url:"/CMD_EMAIL_LIST",method:"POST",params:{action:"save"},domain:!0,schema:{name:n.default.REQUIRED_STRING}});e.updateListInfo=v},2074:function(t,e,s){"use strict";s.r(e);var r=s(2075),i=s.n(r);for(var a in r)"default"!==a&&function(t){s.d(e,t,(function(){return r[t]}))}(a);e.default=i.a},2075:function(t,e,s){"use strict";var r=s(10),i=s(1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,n,o,l=i(s(15)),c=i(s(16)),u=r(s(1560)),d={preload:u.getLists,api:[{command:u.getLists,bind:"lists"}],data:function(){return{listName:"",purgeDays:"90",checkedRows:[]}},computed:{checkedLists:function(){return this.checkedRows.map((function(t){return t.list}))}},watch:{$domain:function(){this.reloadRows()}},methods:{reloadRows:function(){u.getLists()},createList:(o=(0,c.default)(l.default.mark((function t(){return l.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.createList({name:this.listName});case 2:t.sent&&(this.$reset(),this.checkedRows=[],this.reloadRows());case 4:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)}),purgeArchives:(n=(0,c.default)(l.default.mark((function t(){return l.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.purgeListArchives({select:this.checkedLists,purge_days:this.purgeDays});case 2:t.sent&&(this.checkedRows=[],this.reloadRows());case 4:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)}),deleteLists:(a=(0,c.default)(l.default.mark((function t(){return l.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.deleteLists({select:this.checkedLists});case 2:t.sent&&(this.checkedRows=[],this.reloadRows());case 4:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})}};e.default=d},2849:function(t,e){},3125:function(t,e,s){"use strict";var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("app-page",[s("ui-tokens-conditional-button",{attrs:{slot:"header:buttons",theme:"primary",usage:t.$api.lists.length,token:"USERMLISTMAX"},on:{click:function(e){t.$dialog("CREATE_LIST_DIALOG").open()}},slot:"header:buttons"},[s("translate",[t._v("Create Mailing List")]),t._v(" "),s("translate",{attrs:{slot:"limitText"},slot:"limitText"},[t._v("Mailing Lists limit reached")])],1),t._v(" "),s("app-page-section",[s("ui-r-table",t._b({attrs:{disablePagination:""},on:{"update:checkedRows":function(e){t.checkedRows=e}},scopedSlots:t._u([{key:"col:list",fn:function(e){var r=e.list;return[s("ui-link",{attrs:{name:"user/email/lists/view",params:{name:r}}},[t._v("\n                    "+t._s(r)+"@"+t._s(t.$domainUnicode)+"\n                ")])]}},{key:"col:archive_size",fn:function(e){var s=e.archive_size;return[t._v("\n                "+t._s(t._f("humanReadableSize")(s))+"\n            ")]}},{key:"row:actions",fn:function(e){var r=e.item;return s("ui-button-link",{attrs:{icon:"pencil",title:t.$gettext("Edit"),name:"user/email/lists/modify",params:{name:r.list}}})}}])},"ui-r-table",{rows:t.$api.lists,columns:[{id:"list",label:t.$gettext("Mailing List"),editable:!1},{id:"subscribers",label:t.$gettext("Subscribers")},{id:"digest_subscribers",label:t.$gettext("Digest Subscribers")},{id:"archive_size",label:t.$gettext("Archive Size")}],checkedRows:t.checkedRows,verticalLayout:t.$_Client.isPhone},!1),[s("template",{slot:"table:actions"},[s("ui-table-action",{on:{click:function(e){t.$dialog("PURGE_ARCHIVES_DIALOG").open()}}},[s("translate",[t._v("Purge Archives")])],1),t._v(" "),s("ui-table-action",{on:{click:function(e){t.$dialog("DELETE_ITEMS_DIALOG").open()}}},[s("translate",[t._v("Delete")])],1)],1)],2)],1),t._v(" "),s("ui-dialog",{attrs:{id:"CREATE_LIST_DIALOG"}},[s("translate",{attrs:{slot:"title"},slot:"title"},[t._v("Create Mailing List")]),t._v(" "),s("ui-form-element",{attrs:{slot:"content",vertical:"",group:"mailingList",validators:{required:!0,maxLength:64}},slot:"content"},[s("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n                List Name:\n            ")]),t._v(" "),s("input-text",{attrs:{slot:"content",suffix:"@"+t.$domainUnicode},slot:"content",model:{value:t.listName,callback:function(e){t.listName=e},expression:"listName"}})],1),t._v(" "),s("ui-button",{attrs:{slot:"buttons",theme:"primary",validateGroup:"mailingList"},on:{click:t.createList},slot:"buttons"},[s("translate",[t._v("Create")])],1)],1),t._v(" "),s("ui-dialog",{attrs:{id:"PURGE_ARCHIVES_DIALOG"}},[s("translate",{attrs:{slot:"title"},slot:"title"},[t._v("Purge Archives")]),t._v(" "),s("ui-form-element",{attrs:{slot:"content",vertical:""},slot:"content"},[s("input-text",{attrs:{slot:"content",number:"",suffix:t.$gettext("Days.")},slot:"content",model:{value:t.purgeDays,callback:function(e){t.purgeDays=e},expression:"purgeDays"}}),t._v(" "),s("translate",{attrs:{slot:"title"},slot:"title"},[t._v("Purge Archives older than")])],1),t._v(" "),s("ui-button",{attrs:{slot:"buttons",theme:"danger"},on:{click:t.purgeArchives},slot:"buttons"},[s("translate",[t._v("Purge")])],1)],1),t._v(" "),s("ui-dialog-delete-items",{attrs:{subject:t.$ngettext("mailing list","mailing lists",t.checkedRows.length)},on:{"click:confirm":t.deleteLists}})],1)},i=[];s.d(e,"a",(function(){return r})),s.d(e,"b",(function(){return i}))}}]);